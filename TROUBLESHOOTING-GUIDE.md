# دليل استكشاف الأخطاء وإصلاحها لتطبيق الشهادات والبطاقات

هذا الدليل يغطي المشكلات الشائعة التي قد تواجهها أثناء تثبيت أو تشغيل أو نشر تطبيق الشهادات والبطاقات، بالإضافة إلى الحلول المقترحة لها.

## جدول المحتويات

1. [مشكلات التثبيت](#مشكلات-التثبيت)
2. [مشكلات قاعدة البيانات](#مشكلات-قاعدة-البيانات)
3. [مشكلات الخادم](#مشكلات-الخادم)
4. [مشكلات واجهة المستخدم](#مشكلات-واجهة-المستخدم)
5. [مشكلات النشر على Hostinger](#مشكلات-النشر-على-hostinger)
6. [أدوات التشخيص](#أدوات-التشخيص)
7. [الأسئلة الشائعة](#الأسئلة-الشائعة)

## مشكلات التثبيت

### فشل تثبيت الاعتماديات

**المشكلة:** فشل تثبيت اعتماديات npm مع أخطاء.

**الحلول:**

1. حذف ملفات `node_modules` وإعادة التثبيت:
   ```bash
   rm -rf node_modules
   npm install
   ```

2. تحديث npm:
   ```bash
   npm install -g npm@latest
   ```

3. مسح ذاكرة التخزين المؤقت لـ npm:
   ```bash
   npm cache clean --force
   ```

4. التحقق من وجود مشكلات في ملف `package.json` وإصلاحها.

### خطأ "Failed to load module script" في متصفح الويب

**المشكلة:** عند فتح التطبيق في المتصفح، تظهر أخطاء تفيد بفشل تحميل وحدات JavaScript.

**الحلول:**

1. التحقق من إعدادات Vite في ملف `vite.config.ts`:
   - تأكد من تكوين `base` بشكل صحيح
   - تحقق من إعدادات `rollup.output.format`

2. إعادة بناء الواجهة الأمامية مع الخيارات المناسبة:
   ```bash
   ./build-client.sh --verbose
   ```

3. تأكد من أن الخادم Nginx مكون بشكل صحيح لتقديم الملفات الثابتة.

4. مسح ذاكرة التخزين المؤقت للمتصفح والتحميل مرة أخرى.

### مشكلات الخطوط العربية

**المشكلة:** الخطوط العربية لا تظهر بشكل صحيح.

**الحلول:**

1. تأكد من وجود ملفات الخطوط في مجلد `fonts/`:
   ```bash
   ls -la fonts/
   ```

2. التحقق من تسجيل الخطوط في نظام التطبيق:
   - راجع ملفات السجل في `logs/` للبحث عن أخطاء تحميل الخطوط
   - التحقق من ظهور رسالة `تم تسجيل 6 خطوط عربية بنجاح`

3. إعادة تشغيل التطبيق بعد إضافة الخطوط المفقودة:
   ```bash
   pm2 restart certificates-app
   ```

## مشكلات قاعدة البيانات

### فشل الاتصال بقاعدة البيانات

**المشكلة:** يفشل التطبيق في الاتصال بقاعدة البيانات وتظهر أخطاء.

**الحلول:**

1. تحقق من إعدادات الاتصال في ملف `.env`:
   - تأكد من صحة معلومات الاتصال (المضيف، المنفذ، اسم المستخدم، كلمة المرور، اسم قاعدة البيانات)

2. تحقق من تشغيل خادم قاعدة البيانات:
   - لـ PostgreSQL: `sudo systemctl status postgresql`
   - لـ MySQL: `sudo systemctl status mysql`

3. التحقق من وجود قاعدة البيانات:
   - لـ PostgreSQL: `psql -l`
   - لـ MySQL: `mysql -e "SHOW DATABASES;"`

4. التحقق من صلاحيات المستخدم:
   - تأكد من أن المستخدم لديه صلاحيات القراءة والكتابة على قاعدة البيانات

### خطأ "Relation does not exist"

**المشكلة:** ظهور خطأ "relation does not exist" عند تشغيل التطبيق.

**الحلول:**

1. تشغيل سكريبت إنشاء الجداول:
   - للاستخدام مع PostgreSQL: `npx tsx create-db.ts`
   - للاستخدام مع MySQL: `node scripts/setup-mysql.js`

2. التحقق من تنفيذ الهجرات (migrations):
   ```bash
   npx drizzle-kit push
   ```

3. فحص الجداول في قاعدة البيانات:
   - لـ PostgreSQL: `psql -d your_database -c "\dt;"`
   - لـ MySQL: `mysql -e "USE your_database; SHOW TABLES;"`

### مشكلة المستخدم admin غير موجود

**المشكلة:** لا يمكن تسجيل الدخول باستخدام المستخدم admin الافتراضي.

**الحلول:**

1. تشغيل سكريبت البذور (seed):
   ```bash
   node db/seed.ts
   ```

2. التحقق من وجود المستخدم في قاعدة البيانات:
   - لـ PostgreSQL: `psql -d your_database -c "SELECT * FROM users WHERE username = 'admin';"`
   - لـ MySQL: `mysql -e "USE your_database; SELECT * FROM users WHERE username = 'admin';"`

3. إعادة تعيين كلمة مرور المستخدم admin يدويًا:
   ```bash
   node scripts/update-admin-password.ts
   ```

## مشكلات الخادم

### الخادم لا يبدأ التشغيل

**المشكلة:** الخادم يفشل في بدء التشغيل ويعرض رسائل خطأ.

**الحلول:**

1. تحقق من سجلات الخطأ:
   ```bash
   cat logs/error.log
   ```

2. تأكد من تثبيت جميع الاعتماديات:
   ```bash
   npm install
   ```

3. تحقق من وجود ملف `.env` وصحة محتواه.

4. تأكد من أن المنفذ المحدد غير مستخدم بالفعل:
   ```bash
   sudo lsof -i :5000
   ```

5. تشغيل الخادم في وضع التصحيح:
   ```bash
   NODE_ENV=development node --inspect server/index.js
   ```

### أخطاء 500 Internal Server Error

**المشكلة:** عند استخدام التطبيق، تظهر أخطاء 500 (Internal Server Error).

**الحلول:**

1. مراجعة سجلات الخطأ للحصول على مزيد من المعلومات:
   ```bash
   tail -f logs/error.log
   ```

2. تحقق من حالة اتصال قاعدة البيانات:
   ```bash
   node -e "const { checkDatabaseConnection } = require('./server/db'); checkDatabaseConnection().then(console.log).catch(console.error);"
   ```

3. تحقق من وجود استثناءات غير معالجة في الكود.

4. التحقق من صحة طلبات واجهة برمجة التطبيقات (API) باستخدام أداة مثل curl:
   ```bash
   curl -v http://localhost:5000/api/categories
   ```

### أخطاء "Cannot find module"

**المشكلة:** ظهور أخطاء "Cannot find module" عند تشغيل الخادم.

**الحلول:**

1. التحقق من تثبيت الوحدة المفقودة:
   ```bash
   npm install missing-module
   ```

2. التحقق من مسارات الاستيراد في الكود.

3. إعادة بناء التطبيق:
   ```bash
   ./build-server.sh
   ```

4. إعادة تثبيت جميع الاعتماديات:
   ```bash
   rm -rf node_modules
   npm install
   ```

## مشكلات واجهة المستخدم

### الصور أو الأيقونات لا تظهر

**المشكلة:** لا تظهر الصور أو الأيقونات في واجهة المستخدم.

**الحلول:**

1. تحقق من مسارات الصور في وحدة التحكم بالمتصفح.

2. تأكد من تكوين الخادم لتقديم الملفات الثابتة بشكل صحيح.

3. التحقق من ملفات CSS للتأكد من تطبيق الأنماط بشكل صحيح.

4. تأكد من نقل الملفات الثابتة إلى المجلد الصحيح أثناء البناء:
   ```bash
   cp -r client/static/* client/dist/
   ```

### مشكلات التوافق مع المتصفح

**المشكلة:** التطبيق لا يعمل بشكل صحيح في بعض المتصفحات.

**الحلول:**

1. تحديث Browserslist لضمان التوافق مع المتصفحات القديمة:
   ```bash
   npx update-browserslist-db
   ```

2. التحقق من استخدام التنسيق (polyfills) للميزات الجديدة.

3. تعديل ملف `vite.config.ts` لتحسين التوافق:
   ```javascript
   // في vite.config.ts
   export default defineConfig({
     build: {
       target: ['es2015', 'edge79', 'firefox67', 'chrome64', 'safari12'],
     }
   });
   ```

4. تبسيط CSS و JavaScript للمتصفحات القديمة.

### مشكلات الأداء

**المشكلة:** التطبيق بطيء أو يتوقف.

**الحلول:**

1. تنفيذ تصغير وضغط أصول الواجهة الأمامية:
   ```bash
   ./build-client.sh
   ```

2. تحسين تحميل الصور (التحميل الكسول، الصور المستجيبة).

3. تقليل طلبات HTTP عن طريق دمج الملفات.

4. تحسين استعلامات قاعدة البيانات.

5. تمكين التخزين المؤقت للواجهة الأمامية والخادم.

## مشكلات النشر على Hostinger

### مشكلات نطاق النشر

**المشكلة:** التطبيق غير قابل للوصول عبر عنوان URL المخصص.

**الحلول:**

1. تحقق من تكوين DNS:
   - تأكد من أن سجلات DNS تشير إلى عنوان IP الصحيح لخادم Hostinger

2. تحقق من تكوين Nginx:
   - تأكد من أن `server_name` في تكوين Nginx يطابق اسم النطاق الخاص بك

3. تحقق من حالة شهادة SSL.

4. انتظر انتشار تغييرات DNS (قد يستغرق حتى 48 ساعة).

### مشكلات PHP vs Node.js

**المشكلة:** بيئة Hostinger مكونة لـ PHP وليس Node.js.

**الحلول:**

1. تحديث إعدادات Hostinger لاستخدام Node.js:
   - من لوحة تحكم Hostinger، انتقل إلى "أدوات الاستضافة" > "Node.js"
   - تفعيل دعم Node.js واختيار الإصدار المناسب

2. تكوين الخادم للعمل مع Nginx/Apache:
   - تأكد من تعديل ملف `.htaccess` لتوجيه الطلبات إلى تطبيق Node.js
   - تكوين PM2 لإدارة تطبيق Node.js

### أخطاء "Application Error" في Hostinger

**المشكلة:** ظهور رسالة "Application Error" عند محاولة الوصول إلى التطبيق المنشور.

**الحلول:**

1. تحقق من سجلات التطبيق:
   ```bash
   pm2 logs
   ```

2. تأكد من أن المنفذ المستخدم مسموح به في بيئة Hostinger.

3. تأكد من تشغيل التطبيق في وضع الإنتاج:
   ```bash
   NODE_ENV=production pm2 start ecosystem.config.js
   ```

4. تعديل ملف `package.json` لتحديد نقطة بدء صريحة.

## أدوات التشخيص

### أداة فحص النظام

يمكنك استخدام السكريبت التالي لفحص سلامة بيئة التطبيق:

```bash
# تشغيل أداة فحص النظام
node scripts/system-check.js
```

ستقوم هذه الأداة بفحص:
- اتصال قاعدة البيانات
- وجود المجلدات المطلوبة
- صلاحيات الملفات
- تكوين البيئة
- توفر الاعتماديات الخارجية

### سجلات متقدمة

لتمكين تسجيل الأخطاء المتقدم:

1. تعديل مستوى السجل في ملف `.env`:
   ```
   LOG_LEVEL=debug
   ```

2. تشغيل التطبيق مع تتبع التصحيح المفصل:
   ```bash
   DEBUG=* node server/index.js
   ```

3. عرض السجلات في الوقت الفعلي:
   ```bash
   tail -f logs/error.log logs/info.log
   ```

## الأسئلة الشائعة

### هل يمكن استخدام قاعدة بيانات أخرى غير PostgreSQL أو MySQL؟

نعم، يمكن تكوين التطبيق للعمل مع قواعد بيانات أخرى مثل SQLite أو SQL Server أو MongoDB. ومع ذلك، سيتطلب ذلك تعديلات على ملفات `schema.ts` وإنشاء وحدة اتصال مناسبة. راجع الوثائق الخاصة بـ Drizzle ORM للحصول على مزيد من المعلومات.

### كيف يمكنني تغيير المظهر الافتراضي للتطبيق؟

يمكنك تحديث الأنماط في ملف `client/src/index.css` وتعديل متغيرات CSS في ملف `client/src/components/ui/theme.ts`. بعد التغييرات، أعد بناء التطبيق باستخدام:

```bash
./build-client.sh
```

### كيف يمكنني تخصيص نماذج الشهادات؟

يمكنك إضافة وتعديل نماذج الشهادات من خلال:

1. إضافة ملفات الصور للنماذج في `client/static/`
2. تعديل معلومات النموذج في قاعدة البيانات عبر واجهة الإدارة
3. تكوين الحقول المخصصة والتخطيط في إعدادات النموذج

### ما هي العوامل التي تؤثر على أداء التطبيق؟

العوامل الرئيسية التي تؤثر على الأداء تشمل:

1. أداء قاعدة البيانات واستعلاماتها
2. تكوين الخادم (RAM، CPU)
3. حجم وتحسين الصور
4. التخزين المؤقت وتكوينه
5. عدد المستخدمين المتزامنين

### كيف يمكنني ترقية التطبيق إلى إصدار أحدث؟

لترقية التطبيق:

1. نسخ احتياطي للبيانات والملفات الحالية
2. سحب أحدث الإصدارات من Git أو تنزيل الحزمة الجديدة
3. تشغيل الترقيات اللازمة لقاعدة البيانات
4. إعادة بناء التطبيق ونشره
5. اختبار الوظائف بعد الترقية

---

## الحصول على المساعدة

إذا كنت لا تزال تواجه مشكلات بعد استخدام هذا الدليل، يرجى:

1. البحث في [قسم المشكلات GitHub](https://github.com/yourusername/certificates-app/issues) عن مشكلات مماثلة
2. التحقق من [وثائق المستخدم المفصلة](./docs/USER_GUIDE.md)
3. الاتصال بفريق الدعم الفني

---

**تاريخ التحديث:** مايو 2025
#!/bin/bash

# ุณูุฑูุจุช ุชุดุบูู ุจูุฆุฉ ุงูุชุทููุฑ ูููุดุฑูุน (ูุฑููุช ุฅูุฏ ูุจุงู ุฅูุฏ ูุนูุง)

echo "๐ ุจุฏุก ุชุดุบูู ุจูุฆุฉ ุงูุชุทููุฑ..."

# ูู ุญุงูุฉ ูุฑููุช ุฅูุฏ ูุชูุงูู ูุน ุจุงู ุฅูุฏ (ููุณ ุงูุฎุงุฏู)
if [ "$1" == "integrated" ]; then
  echo "๐ ุชุดุบูู ุงููุธุงู ุงููุชูุงูู (ูุฑููุช ุฅูุฏ + ุจุงู ุฅูุฏ ูุนูุง)..."
  cd server && npm run dev
else
  # ุชุดุบูู ุงูุจุงู ุฅูุฏ ูุงููุฑููุช ุฅูุฏ ูู ููุงูุฐ ูููุตูุฉ
  
  # ููุธุงู Linux/Mac (ุจุงุณุชุฎุฏุงู terminator ุฃู ููุดุบููู ูุชุนุฏูุฏ ุงูุฃูุณุงู)
  if [ "$(uname)" == "Darwin" ] || [ "$(uname)" == "Linux" ]; then
    echo "๐ฅ๏ธ ุชุดุบูู ุงูุจุงู ุฅูุฏ ูุงููุฑููุช ุฅูุฏ ูู ููุงูุฐ ูููุตูุฉ..."
    
    # ูุญุงููุฉ ุงุณุชุฎุฏุงู terminator ุฅุฐุง ูุงู ูุชุงุญูุง
    if command -v terminator &> /dev/null; then
      terminator -e "cd $(pwd)/server && npm run dev" -e "cd $(pwd)/client && npm run dev" &
    # ุชุญูู ูู ุชููุฑ tmux
    elif command -v tmux &> /dev/null; then
      tmux new-session -d -s certificates "cd $(pwd)/server && npm run dev"
      tmux split-window -h "cd $(pwd)/client && npm run dev"
      tmux -2 attach-session -d
    else
      # ุทุฑููุฉ ุจุฏููุฉ ูุชุดุบูู ุงูุฎุงุฏููู ูู ุฎูููุฉ ุงูุนูู
      echo "โ๏ธ ูู ูุชู ุงูุนุซูุฑ ุนูู terminator ุฃู tmuxุ ุณูุชู ุชุดุบูู ุงูุฎุงุฏููู ูู ุฎูููุฉ ุงูุนูู..."
      cd server && npm run dev &
      cd client && npm run dev &
    fi
  # ููุธุงู Windows (ููุงูุฐ ูููุตูุฉ)
  elif [ "$(expr substr $(uname -s) 1 10)" == "MINGW32_NT" ] || [ "$(expr substr $(uname -s) 1 10)" == "MINGW64_NT" ]; then
    echo "๐ฅ๏ธ ุชุดุบูู ุงูุจุงู ุฅูุฏ ูุงููุฑููุช ุฅูุฏ ูู ููุงูุฐ ูููุตูุฉ..."
    start cmd /k "cd $(pwd)/server && npm run dev"
    start cmd /k "cd $(pwd)/client && npm run dev"
  else
    # ุญู ุนุงู ูุนูู ูู ูุนุธู ุงูุจูุฆุงุช (ุชุดุบูู ูู ุฎูููุฉ ุงูุนูู)
    echo "โ๏ธ ูุธุงู ุงูุชุดุบูู ุบูุฑ ูุนุฑููุ ุณูุชู ุชุดุบูู ุงูุฎุงุฏููู ูู ุฎูููุฉ ุงูุนูู..."
    cd server && npm run dev &
    cd client && npm run dev &
  fi
fi

echo "โ ุจุฏุฃุช ุจูุฆุฉ ุงูุชุทููุฑ!"
echo "๐ก ุงูุจุงู ุฅูุฏ ูุนูู ุนูู ุงููููุฐ 5000"
echo "๐ ุงููุฑููุช ุฅูุฏ ูุนูู ุนูู ุงููููุฐ 3000"
echo "โ๏ธ ุงุถุบุท Ctrl+C ูุฅููุงู ุจูุฆุฉ ุงูุชุทููุฑ"
# دليل إعداد قاعدة بيانات MySQL على هوستنجر

هذا الدليل يوضح خطوات إعداد قاعدة بيانات MySQL على استضافة هوستنجر واستخدامها مع تطبيق CertificatesCard.

## الخطوة 1: إنشاء قاعدة بيانات على لوحة تحكم هوستنجر

1. قم بتسجيل الدخول إلى لوحة تحكم هوستنجر الخاصة بك.
2. انتقل إلى قسم "قواعد البيانات" من القائمة الجانبية.
3. انقر على "إنشاء قاعدة بيانات جديدة".
4. أدخل اسم قاعدة البيانات، مثل `certificates_db`.
5. أدخل اسم مستخدم وكلمة مرور قوية (احتفظ بهذه المعلومات، ستحتاجها لاحقًا).
6. انقر على "إنشاء".

## الخطوة 2: الحصول على معلومات الاتصال

بعد إنشاء قاعدة البيانات، احصل على معلومات الاتصال التالية:

- **اسم المضيف (Host)**: عادة `localhost` أو قد يكون عنوان IP محدد
- **اسم المستخدم (Username)**: اسم المستخدم الذي أنشأته
- **كلمة المرور (Password)**: كلمة المرور التي حددتها
- **اسم قاعدة البيانات (Database Name)**: اسم قاعدة البيانات التي أنشأتها
- **المنفذ (Port)**: عادة `3306` (المنفذ الافتراضي لـ MySQL)

## الخطوة 3: تكوين ملف hostinger.config.js

قم بإنشاء ملف `hostinger.config.js` في المجلد الرئيسي للمشروع:

```javascript
/**
 * إعدادات الاتصال بقاعدة بيانات MySQL على استضافة هوستنجر
 * يستخدم هذا الملف لتكوين الاتصال مع قاعدة بيانات MySQL في بيئة الإنتاج
 * 
 * النسخة: 1.0 - تاريخ التحديث: 2025-05-04
 */
module.exports = {
  /**
   * إعدادات الاتصال بقاعدة بيانات MySQL
   * يجب تحديث هذه القيم بمعلومات الاتصال الخاصة بك على استضافة هوستنجر
   */
  database: {
    host: 'localhost',
    user: 'اسم_المستخدم',
    password: 'كلمة_المرور',
    name: 'اسم_قاعدة_البيانات',
    port: '3306'
  },
  
  /**
   * إعدادات الخادم
   */
  server: {
    port: 5000,
    host: '0.0.0.0'
  },
  
  /**
   * المسارات ومجلدات التخزين
   */
  paths: {
    uploads: './uploads',
    logs: './logs',
    fonts: './fonts',
    static: './client/static'
  },
  
  /**
   * إعدادات تطبيق Express.js
   */
  express: {
    trustProxy: true,
    compression: true,
    bodyLimit: '10mb'
  },
  
  /**
   * إعدادات التطبيق
   */
  app: {
    baseUrl: 'https://your-domain.com',
    apiPrefix: '/api',
    adminEmail: 'admin@example.com'
  },
  
  /**
   * إعدادات تتبع الأخطاء والتشخيص
   */
  logging: {
    errorLogToFile: true,
    errorLogToDatabase: true,
    errorLogToConsole: true,
    accessLogEnabled: true
  },
  
  /**
   * إعدادات الأمان
   */
  security: {
    sessionSecret: 'استبدل_هذا_بسلسلة_عشوائية_آمنة',
    cookieMaxAge: 7 * 24 * 60 * 60 * 1000, // أسبوع واحد
    csrfProtection: true
  }
};
```

قم بتحديث القيم في القسم `database` بمعلومات الاتصال الخاصة بك.

## الخطوة 4: تكوين ملف .env للإنتاج

قم بإنشاء ملف `.env` في المجلد الرئيسي للمشروع:

```
# نوع قاعدة البيانات المستخدمة: mysql أو postgresql
DB_TYPE=mysql

# عنوان الاتصال بقاعدة البيانات - سيتم استخدام معلومات من hostinger.config.js بدلاً من هذا
# DATABASE_URL=mysql://username:password@localhost:3306/database_name

# إعدادات التطبيق
NODE_ENV=production
PORT=5000

# إعدادات أمان لمصادقة OAuth وجلسات المستخدمين
SESSION_SECRET=replace_with_secure_random_string
```

## الخطوة 5: إعداد قاعدة البيانات

بعد رفع الملفات إلى خادم هوستنجر، قم بتشغيل سكريبت إعداد قاعدة البيانات MySQL:

```bash
node scripts/setup-mysql.js
```

هذا السكريبت سيقوم بإنشاء الجداول اللازمة في قاعدة البيانات MySQL وإضافة مستخدم admin افتراضي.

## الخطوة 6: اختبار الاتصال

يمكنك اختبار الاتصال بقاعدة البيانات من خلال تسجيل الدخول إلى التطبيق باستخدام اسم المستخدم `admin` وكلمة المرور `700700`.

بعد تسجيل الدخول بنجاح، قم بتغيير كلمة المرور الافتراضية.

## الخطوة 7: استكشاف الأخطاء وإصلاحها

### خطأ "لا يمكن الاتصال بقاعدة البيانات"

1. تأكد من صحة بيانات الاتصال في ملف `hostinger.config.js`.
2. تأكد من أن مستخدم قاعدة البيانات لديه الصلاحيات الكافية.
3. تحقق من تمكين الوصول عن بُعد إذا كنت تحاول الاتصال من خارج الخادم.

### خطأ "الجدول غير موجود"

1. تأكد من تشغيل سكريبت `setup-mysql.js` بنجاح.
2. تحقق من وجود الجداول في قاعدة البيانات من خلال phpMyAdmin.

## ملاحظات إضافية

- التطبيق مصمم للعمل مع كل من PostgreSQL وMySQL، حيث يتم تحديد نوع قاعدة البيانات المستخدمة من خلال متغير البيئة `DB_TYPE`.
- في حالة استضافة هوستنجر، يجب استخدام `DB_TYPE=mysql`.
- يتم استخدام محول قاعدة البيانات المناسب تلقائيًا بناءً على نوع قاعدة البيانات المحدد.

## الخطوات القادمة

بعد إعداد قاعدة بيانات MySQL بنجاح، يمكنك متابعة [دليل النشر على هوستنجر](./docs/HOSTINGER-DEPLOYMENT-GUIDE.md) لإكمال عملية نشر التطبيق.
# دليل التشغيل المحلي لمنصة الشهادات والبطاقات الإلكترونية

هذا الدليل يشرح كيفية تثبيت وتشغيل منصة الشهادات والبطاقات الإلكترونية على جهازك المحلي بدون الحاجة إلى استضافة.

## المتطلبات

1. Node.js الإصدار 18 أو أحدث
2. NPM الإصدار 8 أو أحدث
3. (اختياري) MySQL إذا كنت ترغب في استخدام قاعدة بيانات دائمة

## خطوات التثبيت

### 1. تنزيل الكود

1. قم بتنزيل الكود المصدري وفك ضغطه أو استخدم Git:

```bash
git clone https://github.com/username/CertificatesCard.git
cd CertificatesCard
```

### 2. تثبيت الاعتماديات

```bash
npm install
```

### 3. إعداد ملف البيئة

1. انسخ ملف `.env.example` إلى `.env`:

```bash
cp .env.example .env
```

2. قم بتعديل ملف `.env` حسب احتياجاتك:

```
# نوع البيئة: development أو production
NODE_ENV=development

# منفذ الخادم (يجب أن يكون 5000 في هوستنجر، 3000 محليًا)
PORT=3000

# نوع قاعدة البيانات: mysql أو postgres أو memory
DB_TYPE=memory

# إعدادات قاعدة البيانات MySQL - تستخدم في حالة DB_TYPE=mysql
# DB_HOST=localhost
# DB_PORT=3306
# DB_USER=root
# DB_PASSWORD=
# DB_NAME=certificates_db

# إعدادات الأمان
SESSION_SECRET=my_development_session_key

# إعدادات التخزين
UPLOADS_DIR=uploads
TEMP_DIR=temp
LOGS_DIR=logs

# مسار الخطوط
FONTS_DIR=fonts
```

### 4. خيارات قاعدة البيانات

#### أ. استخدام قاعدة بيانات في الذاكرة (الافتراضي)

هذا الخيار الأسهل للبدء سريعًا، حيث لا يتطلب تثبيت أي قاعدة بيانات:

```
DB_TYPE=memory
```

#### ب. استخدام MySQL

1. تأكد من تثبيت وتشغيل MySQL على جهازك
2. أنشئ قاعدة بيانات جديدة:

```sql
CREATE DATABASE certificates_db;
```

3. قم بتعديل ملف `.env`:

```
DB_TYPE=mysql
DB_HOST=localhost
DB_PORT=3306
DB_USER=root
DB_PASSWORD=your_password
DB_NAME=certificates_db
```

4. قم بتنفيذ سكريبت إنشاء جداول قاعدة البيانات:

```bash
node ./scripts/setup-mysql.js
```

#### ج. استخدام PostgreSQL

1. تأكد من تثبيت وتشغيل PostgreSQL على جهازك
2. أنشئ قاعدة بيانات جديدة:

```sql
CREATE DATABASE certificates_db;
```

3. قم بتعديل ملف `.env`:

```
DB_TYPE=postgres
DATABASE_URL=postgresql://username:password@localhost:5432/certificates_db
```

### 5. إنشاء المجلدات الضرورية

```bash
mkdir -p uploads temp logs
```

### 6. بدء تشغيل التطبيق

#### خلال التطوير:

```bash
npm run dev
```

#### البناء والتشغيل:

```bash
npm run build
npm start
```

### 7. الوصول إلى التطبيق

1. افتح متصفح الويب وانتقل إلى:
   - `http://localhost:3000` (إذا كنت تستخدم `PORT=3000`)
   - أو `http://localhost:5000` (إذا كنت تستخدم `PORT=5000`)

2. سجل دخولك باستخدام:
   - اسم المستخدم: `admin`
   - كلمة المرور: `700700`

## استكشاف الأخطاء وإصلاحها

### المشكلة: خطأ EADDRINUSE (المنفذ مستخدم بالفعل)

```
Error: listen EADDRINUSE: address already in use
```

**الحل**: المنفذ المحدد مستخدم بالفعل بواسطة برنامج آخر. قم بتغيير المنفذ في ملف `.env`:

```
PORT=3001
```

### المشكلة: خطأ في قاعدة البيانات

```
Error: connect ETIMEDOUT
```

**الحل**: 
1. تأكد من تشغيل خادم قاعدة البيانات
2. تحقق من صحة إعدادات الاتصال في ملف `.env`
3. جرب استخدام وضع الذاكرة المؤقتة:

```
DB_TYPE=memory
```

### المشكلة: الخطوط العربية لا تظهر بشكل صحيح

**الحل**: تأكد من وجود ملفات الخطوط في مجلد `fonts/` ومن وجود المجلد في مسار المشروع الصحيح.

## ملاحظات هامة

1. **أمان التطبيق**: في بيئة الإنتاج، قم بتغيير كلمة مرور المسؤول الافتراضية وقم بتعيين مفتاح جلسة قوي.

2. **الملفات المرفوعة**: جميع الملفات المرفوعة تذهب إلى مجلد `uploads/`. تأكد من أن هذا المجلد له الصلاحيات المناسبة.

3. **التغييرات في قاعدة البيانات**: إذا غيرت مخطط قاعدة البيانات، فستحتاج إلى إعادة تشغيل سكريبت الإعداد.

4. **المنافذ المنخفضة**: على أنظمة التشغيل Linux/macOS، تتطلب المنافذ أقل من 1024 (مثل 80) صلاحيات مدير النظام. استخدم منفذًا أعلى مثل 3000 أو 5000 للتطوير.

## البنية والتنظيم

المشروع منظم كالتالي:

- `client/`: تطبيق الواجهة الأمامية (React)
- `server/`: خادم الواجهة الخلفية (Express.js)
- `shared/`: الملفات المشتركة مثل مخططات قاعدة البيانات
- `fonts/`: ملفات الخطوط المستخدمة في إنشاء الشهادات
- `uploads/`: مكان تخزين الصور والملفات المرفوعة
- `scripts/`: سكريبتات مساعدة للإعداد والصيانة

---

آخر تحديث: 04 مايو 2025
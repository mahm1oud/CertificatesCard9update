# دليل تثبيت الخادم الموحد على هوستنجر

## مقدمة

هذا الدليل يشرح كيفية تثبيت الخادم الموحد (الواجهة والخلفية في نفس المكان) على استضافة هوستنجر. الخادم الموحد يبسط عملية النشر ويحل مشكلات الاتصال بين الواجهة الأمامية و API.

## المتطلبات

1. استضافة هوستنجر مع دعم Node.js
2. قاعدة بيانات MySQL
3. وصول إلى SSH (اختياري للتثبيت المتقدم)
4. دومين أو نطاق فرعي موجه إلى الاستضافة

## خطوات التثبيت

### 1. تحضير المشروع

1. قم ببناء المشروع للإنتاج:

```bash
# بناء واجهة المستخدم
npm run build:client

# بناء الخادم الخلفي
npm run build:server
```

2. تأكد من وجود الملفات التالية:
   - `dist/server` - ملفات الخادم المبنية
   - `dist/public` - ملفات واجهة المستخدم المبنية

### 2. إعداد قاعدة البيانات MySQL

1. قم بإنشاء قاعدة بيانات MySQL جديدة في لوحة تحكم هوستنجر
2. احتفظ بمعلومات الاتصال (اسم المستخدم، كلمة المرور، اسم قاعدة البيانات)

### 3. تحميل الملفات إلى هوستنجر

1. قم بتحميل محتويات مجلد `dist` إلى المجلد الرئيسي لاستضافتك (public_html) 
2. قم بنقل مجلد `dist/public` ليكون المجلد الرئيسي للموقع
3. قم بنقل مجلد `dist/server` ليكون خارج المجلد الرئيسي للموقع (للأمان)

### 4. إعداد ملف التكوين

1. قم بإنشاء ملف `hostinger.config.js` في المجلد الرئيسي:

```javascript
module.exports = {
  // إعدادات قاعدة البيانات
  database: {
    type: 'mysql',
    host: 'localhost',           // عادة ما تكون localhost
    port: '3306',                // المنفذ الافتراضي لـ MySQL
    user: 'اسم_المستخدم',       // استبدله باسم المستخدم الخاص بك
    password: 'كلمة_المرور',     // استبدلها بكلمة المرور الخاصة بك
    name: 'اسم_قاعدة_البيانات',  // استبدله باسم قاعدة البيانات الخاصة بك
    connectionLimit: 10
  },
  
  // إعدادات الخادم
  server: {
    port: 3000,                  // المنفذ الذي سيعمل عليه الخادم
    host: '0.0.0.0'              // للاستماع على جميع الواجهات
  },
  
  // المسارات
  paths: {
    uploads: 'uploads',          // مجلد تخزين الملفات المرفوعة
    temp: 'temp',                // مجلد للملفات المؤقتة
    fonts: 'fonts',              // مجلد الخطوط
    static: 'public',            // مجلد الملفات الثابتة
    logs: 'logs'                 // مجلد ملفات السجل
  },
  
  // إعدادات الأمان
  security: {
    sessionSecret: 'مفتاح_طويل_وعشوائي_وآمن_للجلسات', // استبدله بمفتاح عشوائي
    jwtSecret: 'مفتاح_طويل_وعشوائي_وآمن_للتوكن'        // استبدله بمفتاح عشوائي
  }
};
```

2. قم بإنشاء ملف `.env` للمتغيرات البيئية:

```
NODE_ENV=production
DB_TYPE=mysql
PORT=3000
```

### 5. إعداد Node.js في هوستنجر

1. قم بالدخول إلى لوحة تحكم هوستنجر
2. اذهب إلى قسم "Website" > "Node.js"
3. قم بتفعيل Node.js
4. حدد الإصدار (يُفضل استخدام Node.js 18 أو أحدث)
5. حدد ملف البدء: `server/unified-server-new.js`
6. حدد المنفذ: `3000` (يجب أن يتطابق مع ما حددته في ملف التكوين)

### 6. إعداد إعادة التوجيه

1. قم بإنشاء ملف `.htaccess` في المجلد الرئيسي:

```apache
# إعادة توجيه الطلبات إلى خادم Node.js
<IfModule mod_rewrite.c>
  RewriteEngine On
  
  # عدم إعادة توجيه الملفات الموجودة
  RewriteCond %{REQUEST_FILENAME} -f [OR]
  RewriteCond %{REQUEST_FILENAME} -d
  RewriteRule ^ - [L]
  
  # إعادة توجيه طلبات API
  RewriteRule ^api/(.*) http://localhost:3000/api/$1 [P,L]
  
  # إعادة توجيه باقي الطلبات إلى الملفات الثابتة
  RewriteRule ^ index.html [L]
</IfModule>
```

### 7. بدء تشغيل الخادم

1. من لوحة تحكم هوستنجر، قم ببدء تشغيل تطبيق Node.js
2. تحقق من السجلات للتأكد من عدم وجود أخطاء
3. تحقق من أن الموقع يعمل عن طريق زيارة النطاق الخاص بك

## حل المشكلات الشائعة

### مشكلة: الموقع لا يحمّل

- تحقق من أن خادم Node.js يعمل في لوحة التحكم
- تحقق من إعادة التوجيه في ملف `.htaccess`
- تحقق من السجلات بحثًا عن أخطاء

### مشكلة: خطأ في الاتصال بقاعدة البيانات

- تأكد من صحة معلومات الاتصال في `hostinger.config.js`
- تحقق من أن مستخدم قاعدة البيانات لديه الصلاحيات المناسبة
- تحقق من أن جداول قاعدة البيانات تم إنشاؤها بشكل صحيح

### مشكلة: الواجهة تظهر ولكن API لا تعمل

- تأكد من أن إعادة التوجيه في `.htaccess` مكتوبة بشكل صحيح
- تحقق من أن خادم Node.js يستمع على المنفذ الصحيح
- تأكد من أن عنوان API في الواجهة يستخدم `/api` نسبيًا وليس عنوانًا مطلقًا

## تحديث المشروع

لتحديث المشروع على هوستنجر:

1. قم ببناء النسخة الجديدة محليًا
2. قم بتحميل الملفات المحدثة إلى الاستضافة
3. أعد تشغيل خادم Node.js من لوحة التحكم

## خاتمة

باتباع هذا الدليل، يجب أن يكون لديك الآن خادم موحد يعمل بشكل صحيح على استضافة هوستنجر، مع تكامل سلس بين الواجهة الأمامية وواجهة برمجة التطبيقات.

لأي استفسارات إضافية، يرجى مراجعة وثائق هوستنجر الرسمية أو التواصل مع الدعم الفني.